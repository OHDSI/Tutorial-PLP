[
  {
    "objectID": "exampleCode/networkStudy.html",
    "href": "exampleCode/networkStudy.html",
    "title": "PatientLevelPrediction with Strategus",
    "section": "",
    "text": "1 Overview\nThis document shows how to:\n\nLoad cohort JSONs and generate cohorts using CohortGenerator.\nConfigure a PatientLevelPrediction (PLP) design.\nAssemble Strategus analysis specifications\nExecute the analysis specifications against a DuckDB Synthea example database.\n\n\n\n2 Setup\nHere we need to set up our environment. First, if you donâ€™t have R installed please follow the HADES installation instructions for your operating system from here.\nUsually to run OHDSI packages you need to install at least R, java and a github acount (to install pacakges from github without rate-limiting). Once you have thatset up you can install the required packages for this tutorial. They are PatientLevelPrediction, CohortGenerator and Strategus. Also to use the example database you need to install duckdb. Since Strategus is still under development you need to install it from github which requires the remotes package.\n\n\nCode\n# Install required packages (uncomment if needed):\n# install.packages(c(\"PatientLevelPrediction\", \"CohortGenerator\", \"remotes\", \"duckdb\"))\n# remotes::install_github(\"OHDSI/Strategus\")\n\nlibrary(PatientLevelPrediction)\nlibrary(Strategus)\n\nseed &lt;- 42\n\n\nFurther please download the example database from here and place in your location of choice. Then update the dbPath cariable to point to that location:\n\n\nCode\ndbPath &lt;- \"~/database/database-1M_filtered.duckdb\"\n\n\nHere are the schema settings and cohort_table name for the example database. If you would run tthe example for your own database you would need to update these settings.\n\n\nCode\ncdmSchema &lt;- \"main\"\nworkSchema &lt;- \"cohorts\"\ncohortTable &lt;- \"cohort_table\"\n\n\n\n\n3 Cohort Generation\nTo generate the cohorts we need to load the JSON files and create a cohort definition set. Then we can create the shared resource specifications and module specifications for cohort generation. To get the JSON files you can download them from here\n\n\nCode\ntargetFile &lt;- \"./cohorts/31_[T] Pandemic Prediction new target.json\"\noutcomeFile &lt;- \"./cohorts/14_[O] Pandemic Prediction outcome pneumonia in hospital.json\"\n\ncohortDefinitions &lt;- CohortGenerator::createEmptyCohortDefinitionSet()\ncohortDefinitions[1, ] &lt;- list(\n  cohortId = 1,\n  cohortName = \"Target\",\n  sql = \"\",\n  json = readChar(targetFile, file.info(targetFile)$size)\n)\ncohortDefinitions[2, ] &lt;- list(\n  cohortId = 2,\n  cohortName = \"Outcome\",\n  sql = \"empty\",\n  json = readChar(outcomeFile, file.info(outcomeFile)$size)\n)\n\ncohortGeneratorModule &lt;- CohortGeneratorModule$new()\ncohortDefShared &lt;- cohortGeneratorModule$createCohortSharedResourceSpecifications(cohortDefinitions)\n\ncohortGeneratorModuleSpecifications &lt;- cohortGeneratorModule$createModuleSpecifications(\n  generateStats = TRUE\n)\n\n\n\n\n4 PLP Design\n\n\nCode\ncovariateSettings &lt;- FeatureExtraction::createDefaultCovariateSettings()\n\npopulationSettings &lt;- createStudyPopulationSettings(\n  binary = TRUE,\n  removeSubjectsWithPriorOutcome = TRUE,\n  requireTimeAtRisk = FALSE,\n  riskWindowStart = 1,\n  riskWindowEnd = 30,\n)\n\npreprocessSettings &lt;- createPreprocessSettings(\n  minFraction = 0.001,\n  normalize = TRUE,\n  removeRedundancy = TRUE\n)\n\nsplitSettings &lt;- createDefaultSplitSetting(splitSeed = seed)\n\n# Choose model based on parameter (baseline: lasso logistic)\nmodelSettings &lt;- PatientLevelPrediction::setLassoLogisticRegression(seed = seed)\n  # Other options (require additional packages; see Exercises below):\n  # PatientLevelPrediction::setGradientBoostingMachine(ntrees = 100, seed = seed),\n  # PatientLevelPrediction::setRandomForest(mtries = 10, seed = seed),\n  # PatientLevelPrediction::setXgBoost(nrounds = 100, seed = seed),\n\nmessage(sprintf(\"Model selected: %s | Split seed: %s\", \"LASSO\", seed))\n\nmodelDesign &lt;- PatientLevelPrediction::createModelDesign(\n  targetId = 1,\n  outcomeId = 2,\n  populationSettings = populationSettings,\n  covariateSettings = covariateSettings,\n  preprocessSettings = preprocessSettings,\n  modelSettings = modelSettings,\n  splitSettings = splitSettings,\n  runCovariateSummary = TRUE\n)\n\nplpModule &lt;- PatientLevelPredictionModule$new()\nplpModuleSpecs &lt;- plpModule$createModuleSpecifications(modelDesignList = modelDesign)\n\n\n\n\n5 Strategus Analysis Specifications\n\n\nCode\nanalysisSpecifications &lt;- createEmptyAnalysisSpecifications() |&gt;\n  addSharedResources(cohortDefShared) |&gt;\n  addModuleSpecifications(cohortGeneratorModuleSpecifications) |&gt;\n  addModuleSpecifications(plpModuleSpecs)\n\nParallelLogger::saveSettingsToJson(analysisSpecifications, \"analysisSpecifications.json\")\n\n\n\n\n6 Execution settings and running\n\n\nCode\nworkFolder &lt;- normalizePath(\"./results/strategus/work\")\nresultsFolder &lt;- normalizePath(\"./results/strategus/results\")\n\nexecutionSettings &lt;- Strategus::createCdmExecutionSettings(\n  workDatabaseSchema = workSchema,\n  cdmDatabaseSchema = cdmSchema,\n  cohortTableNames = CohortGenerator::getCohortTableNames(cohortTable = cohortTable),\n  workFolder = workFolder,\n  resultsFolder = resultsFolder,\n  incremental = FALSE\n)\n\nconnectionDetails &lt;- DatabaseConnector::createConnectionDetails(\n  dbms = \"duckdb\",\n  server = dbPath\n)\n\n# Execute the study (may take some minutes depending on data size)\nStrategus::execute(\n  analysisSpecifications,\n  executionSettings = executionSettings,\n  connectionDetails = connectionDetails\n)\n\n\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n\n\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |======================================================================| 100%\n\n\nGenerating cohort set took 1.83 secs\n\n\ncdmDatabaseId is not a string - this will cause issues when inserting into a result database so casting it\nUse timeStamp: TRUE\nData for target 1 exists at /home/egill/github/Tutorial-PLP/exampleCode/results/strategus/work/PatientLevelPredictionModule/targetId_1_L1\nDiagnosis  Analysis_1 exists at /home/egill/github/Tutorial-PLP/exampleCode/results/strategus/work/PatientLevelPredictionModule/Analysis_1\nAnalysis  Analysis_1 exists at /home/egill/github/Tutorial-PLP/exampleCode/results/strategus/work/PatientLevelPredictionModule/Analysis_1\n\n\nPLP result tables already exist\nPLP result migration being applied\nMigrating data set\nMigrator using SQL files in PatientLevelPrediction\n\n\nClosing database connection\nUpdating version number\n\n\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting result @ /home/egill/github/Tutorial-PLP/exampleCode/results/strategus/work/PatientLevelPredictionModule/Analysis_1/plpResult into database\nresult loaded\n\n\nTAR exists\ntarId: 1\njson in jsons:TRUE\nCohort Target exists in cohort_definition with cohort id1\nCohort Target exists in cohorts with cohort id1\ntId: 1\njson in jsons:TRUE\nCohort Outcome exists in cohort_definition with cohort id2\nCohort Outcome exists in cohorts with cohort id2\noId: 2\nPopulation settings exists\npopSetId: 1\nCovariate setting exists\ncovSetId: 1\nModel setting exists\nmodSetId: 1\nSplit setting exists\nplpDataSetId: 1\nfeature engineering setting exists\nFESetId: 1\nsample setting exists\nsampleSetId: 1\ntidy covariates setting exists\ntidySetId: 1\nSplit setting exists\nsplitId: 1\nmodelDesignId: 1\nDatabase meta data  already exists\nDatabase1 already exists\nDatabase meta data  already exists\nDatabase1 already exists\nmodelId: 1 inserted for modelDesignId 1and databaseId 1\nTAR exists\njson in jsons:TRUE\nCohort Target exists in cohort_definition with cohort id1\nCohort Target exists in cohorts with cohort id1\njson in jsons:TRUE\nCohort Outcome exists in cohort_definition with cohort id2\nCohort Outcome exists in cohorts with cohort id2\nPopulation settings exists\nSplit setting exists\nInserting performance...\nperformanceId: 1\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting attrition for performance 1\n\n\nAdding PredictionDistribution\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting predictionDistribution for performance 1\n\n\nAdding ThresholdSummary\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting thresholdSummary for performance 1\n\n\nAdding EvaluationStatistics\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting evaluationSummary for performance 1\n\n\nAdding CalibrationSummary\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting calibrationSummary for performance 1\n\n\nAdding DemographicSummary\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting demographicSummary for performance 1\n\n\nRestricting to covariates included in model\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nInserting covariateSummary for result 1\n\n\nTAR exists\ntarId: 1\njson in jsons:TRUE\nCohort Target exists in cohort_definition with cohort id1\nCohort Target exists in cohorts with cohort id1\ntId: 1\njson in jsons:TRUE\nCohort Outcome exists in cohort_definition with cohort id2\nCohort Outcome exists in cohorts with cohort id2\noId: 2\nPopulation settings exists\npopSetId: 1\nCovariate setting exists\ncovSetId: 1\nModel setting exists\nmodSetId: 1\nSplit setting exists\nplpDataSetId: 1\nfeature engineering setting exists\nFESetId: 1\nsample setting exists\nsampleSetId: 1\ntidy covariates setting exists\ntidySetId: 1\nSplit setting exists\nsplitId: 1\nmodelDesignId: 1\nDatabase meta data  already exists\nDatabase1 already exists\ndiagnosticId: 1\nAdding DiagnosticSummary\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nAdding DiagnosticParticipants\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nAdding DiagnosticPredictors\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nAdding DiagnosticOutcomes\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n\n\nAdding DiagnosticDesigns\n\n\n\n\n7 View Results\n\n\nCode\nanalysisLocation &lt;- file.path(workFolder, \"PatientLevelPredictionModule\")\nPatientLevelPrediction::viewMultiplePlp(analysisLocation)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Home",
    "section": "",
    "text": "Welcome. See the tutorial page in the navbar."
  }
]